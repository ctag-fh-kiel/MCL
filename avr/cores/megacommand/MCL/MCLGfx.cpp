#include "MCL_impl.h"

void MCLGfx::init_oled() {
#ifdef OLED_DISPLAY
  oled_display.begin();

  oled_display.clearDisplay();
  oled_display.invertDisplay(0);
  oled_display.setRotation(2);
  oled_display.setTextSize(1);
  oled_display.setTextColor(WHITE, BLACK);
  oled_display.setCursor(0, 0);
  oled_display.display();
#endif
}

#ifdef OLED_DISPLAY
#define BITMAP_MCL_LOGO_W 58
#define BITMAP_MCL_LOGO_H 19

const unsigned char mcl_logo_bitmap[] PROGMEM = {
    0x01, 0xff, 0xf3, 0xff, 0xf3, 0xfe, 0x00, 0x00, 0x03, 0xff, 0xf3, 0xff,
    0xf3, 0xfe, 0x00, 0x00, 0x07, 0xff, 0xf3, 0xff, 0xf3, 0xfe, 0x00, 0x00,
    0x0f, 0xff, 0xf3, 0xff, 0xf3, 0xfe, 0x00, 0x00, 0x1f, 0xff, 0xf3, 0xff,
    0xf3, 0xfe, 0x00, 0x00, 0x3f, 0xff, 0xf3, 0xff, 0xf3, 0xfe, 0x00, 0x00,
    0x7f, 0xff, 0xf3, 0xf8, 0x03, 0xfe, 0x00, 0x00, 0xff, 0xff, 0xf3, 0xf8,
    0x03, 0xfe, 0x00, 0x00, 0xff, 0xff, 0xf3, 0xf8, 0x03, 0xfe, 0x00, 0x00,
    0x7f, 0xff, 0xf3, 0xf8, 0x03, 0xfe, 0x00, 0x00, 0x3f, 0xdf, 0xf3, 0xf8,
    0x03, 0xfe, 0x7f, 0xc0, 0x1f, 0x9f, 0xf3, 0xf8, 0x03, 0xfe, 0x7f, 0xc0,
    0x0f, 0x1f, 0xf3, 0xf8, 0x03, 0xfe, 0x7f, 0xc0, 0x06, 0x1f, 0xf3, 0xff,
    0xf3, 0xfe, 0x7f, 0x80, 0x00, 0x1f, 0xf3, 0xff, 0xf3, 0xfe, 0x7f, 0x00,
    0x00, 0x1f, 0xf3, 0xff, 0xf3, 0xfe, 0x7e, 0x00, 0x00, 0x1f, 0xf3, 0xff,
    0xf3, 0xfe, 0x7c, 0x00, 0x00, 0x1f, 0xf3, 0xff, 0xf3, 0xfe, 0x78, 0x00,
    0x00, 0x1f, 0xf3, 0xff, 0xf3, 0xfe, 0x70, 0x00};

// 'evilknievel', 45x32px
const unsigned char evilknievel_bitmap[] PROGMEM = {
    0x00, 0x7f, 0xff, 0xff, 0xff, 0x00, 0x00, 0x7f, 0xff, 0xd5, 0xff, 0x00,
    0x00, 0x6f, 0xe8, 0x2a, 0xff, 0x80, 0x00, 0x77, 0x80, 0x05, 0x7f, 0x80,
    0x00, 0x62, 0x00, 0x02, 0xff, 0x80, 0x00, 0x70, 0x00, 0x05, 0x7f, 0x00,
    0x00, 0x60, 0x00, 0x02, 0xbf, 0x00, 0x00, 0x20, 0x00, 0x01, 0x7f, 0x00,
    0x00, 0x60, 0x00, 0x02, 0xff, 0x00, 0x00, 0x28, 0x00, 0x01, 0x7f, 0x00,
    0x00, 0x3f, 0x87, 0xf2, 0xfe, 0x00, 0x00, 0x7f, 0xd7, 0xfd, 0x7e, 0x00,
    0x00, 0x7f, 0xef, 0xfe, 0xfe, 0x00, 0x00, 0x7f, 0xc7, 0xff, 0xfc, 0x00,
    0x00, 0x7f, 0xc7, 0xfe, 0xec, 0x00, 0x00, 0x3f, 0xc3, 0xfd, 0xd4, 0x00,
    0x00, 0x1e, 0x80, 0xfa, 0xec, 0x00, 0x00, 0x15, 0x00, 0x05, 0x54, 0x00,
    0x00, 0x1a, 0x80, 0x02, 0xa8, 0x00, 0x00, 0x1d, 0xc0, 0x05, 0x78, 0x00,
    0x00, 0x0a, 0xe2, 0x0a, 0xfc, 0x00, 0x00, 0x1d, 0x00, 0x05, 0x5c, 0x00,
    0x00, 0x0b, 0xc0, 0x0a, 0xbe, 0x00, 0x00, 0x3d, 0xc0, 0x15, 0x5f, 0x80,
    0x07, 0xfe, 0xe8, 0x0a, 0xbf, 0xf0, 0x1f, 0xff, 0xd0, 0x17, 0x5f, 0xf8,
    0x3f, 0xff, 0xe8, 0x0f, 0xbf, 0xf8, 0x3f, 0xff, 0x00, 0x1f, 0x7f, 0xf8,
    0x7f, 0xff, 0x80, 0x3e, 0xbf, 0xf8, 0x7f, 0xff, 0xc0, 0x7d, 0x7f, 0xf8,
    0xff, 0xff, 0xfa, 0xfa, 0xff, 0xf8, 0xff, 0xff, 0x7f, 0xf5, 0x7f, 0xf8};
//  oled_display.drawBitmap(128-45, 0, evilknievel_bitmap, 45, 32);

#endif
void MCLGfx::draw_evil() {
#ifdef OLED_DISPLAY
  auto oldfont = oled_display.getFont();
  oled_display.setFont(&TomThumb);
  for (int8_t x = -45; x < 128 - 45; x += 2) {
  oled_display.fillScreen(WHITE);
  oled_display.setCursor(x - 60, 10);
  oled_display.setTextColor(BLACK, WHITE);
  oled_display.println("THIS PIECE OF");
  oled_display.setCursor(x - 60, 20);
  oled_display.println("MACHINE IS O.K.");

  oled_display.drawBitmap(x, 0, evilknievel_bitmap, 45, 32, BLACK);
  oled_display.display();
}
  delay(1800);
  oled_display.setTextColor(WHITE, BLACK);
  oled_display.setFont(oldfont);
#endif
}

void MCLGfx::splashscreen(unsigned char* bitmap) {
#ifdef OLED_DISPLAY
  DEBUG_PRINTLN(F("OLED enabled"));
  oled_display.setTextSize(2);
  oled_display.setTextColor(WHITE, BLACK);
  oled_display.setCursor(40, 0);

  oled_display.drawBitmap(35, 8, bitmap, BITMAP_MCL_LOGO_W,
                          BITMAP_MCL_LOGO_H, WHITE);
  /* oled_display.println("MEGA");
   oled_display.setCursor(22, 15);
   oled_display.println("COMMAND");
   */
  oled_display.setCursor(90, 8);
  oled_display.setTextSize(1);
  oled_display.print("V");
  oled_display.print(VERSION_STR);
  /*  for (float length = 0; length < 32; length += 0.7) {

      // display.fillRect(0, 0, 128, length, BLACK);
      for (uint8_t x = 0; x < 50 + (length * 5); x++) {

        oled_display.drawPixel(random(20, 110), 30 - random(0, (int)length),
                               BLACK);
      }

   âˆš   //:    display.drawLine(0, length, 128, length, BLACK);

      oled_display.display();
    }  oled_display.clearDisplay();
    */
  oled_display.display();
  delay(750);

  for (uint8_t a = 0; a < 32; a++) {
    oled_display.drawLine(35, a, BITMAP_MCL_LOGO_W + 35 + 31, a, BLACK);
    oled_display.drawLine(35, 32 - a, BITMAP_MCL_LOGO_W + 35 + 31, 32 - a,
                          BLACK);
    oled_display.display();
  }

#else

  DEBUG_PRINTLN(F("HD44780 enabled"));
  char str1[17] = "MEGACOMMAND LIVE";
  char str2[17] = VERSION_STR;
  str1[16] = '\0';
  display_text(&str1[0], &str2[0]);
  delay(200);
#endif
  // while (rec_global == 0) {

  //  GUI.setPage(&grid_page);
}
void MCLGfx::display_text(const char *str1, const char *str2) {
  LCD.goLine(0);
  LCD.puts(str1);
  LCD.goLine(1);
  LCD.puts(str2);
}
void MCLGfx::alert(const char *str1, const char *str2) {
#ifdef OLED_DISPLAY
  mcl_gui.draw_infobox(str1, str2);
  oled_display.display();
  delay(700);
  oled_display.clearDisplay();
#else
  GUI.flash_strings_fill(str1, str2);
  GUI.display_lcd();
#endif
  DEBUG_PRINTLN(str1);
  DEBUG_PRINTLN(str2);
}

MCLGfx gfx;
